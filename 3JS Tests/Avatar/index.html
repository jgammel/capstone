<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Load Avatar - glTF version</title>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="../libraries/three.js-master/build/three.js"></script>
		<!--Must include objecct loader. GLTF is preferred-->
		<script src="../libraries/three.js-master/examples/js/loaders/GLTFLoader.js"></script>
		<script src="../libraries/dat-gui/build/dat.gui.js"></script>
		<script src="../libraries/three.js-master/examples/js/WebGL.js"></script>
		<script>
			//Check to see if Browser supports WebGL
			if ( WEBGL.isWebGLAvailable() === false ) {
				document.body.appendChild( WEBGL.getWebGLErrorMessage() );
			}
			var container;
			var camera, scene, renderer;
			var mouseX = 0, mouseY = 0;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
			var object;

			//init renders the scene
			init();
			//animate animates frames in a loop
			animate();

			function init() {
				//create the container that will house the renderer later on
				container = document.createElement( 'div' );
				document.body.appendChild( container );


				camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.set( 0, 1, 2 );

				// scene, background, fog, etc
				scene = new THREE.Scene();
				scene.fog = new THREE.Fog( 0xe0e0e0, 20, 100 );
				
				//lights
				var ambientLight = new THREE.AmbientLight( 0xf3f3f3, 0.9 );//ambient lights light a scene uniformly and cannot be used to cast shadow as they do not have any direction
				scene.add( ambientLight );

				var directionalLight = new THREE.DirectionalLight( 0xffffff, 0.5 );
				directionalLight.setPosition = new THREE.Vector3(5,5,0);
				scene.add( directionalLight );
				
				scene.add( camera );

				//model loader
				// Instantiate a loader
				var loader = new THREE.GLTFLoader(); 
				
				//this type of file loading only works when running a local server. Currently using MAMP
				loader.load('glb/T-Pose-with-skeleton.gltf',
				function(gltf){
					object = gltf.scene;
					scene.add(object);
					console.log("called when the resource is loaded");
				},
				function(xhr){
					console.log("called while loading is progressing");
					if ( xhr.lengthComputable ) {
						var percentComplete = xhr.loaded / xhr.total * 100;
						console.log( 'model ' + Math.round( percentComplete, 2 ) + '% downloaded' );
					}
				},
				function(error){
					console.log("called when loading has errors");
					console.log(error);
				});

				// some code for loading manager might go here?

				// texture
				// some code for a texture loader might go here

				
				//renderer
				renderer = new THREE.WebGLRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
				//
				window.addEventListener( 'resize', onWindowResize, false );
			}
			
			function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
			
			
			//
			function animate() {
				requestAnimationFrame( animate );
				render();
			}
			
			function render() {
				camera.position.x += ( mouseX - camera.position.x ) * .05;
				camera.position.y += ( - mouseY - camera.position.y ) * .05;
				camera.lookAt( scene.position );
				renderer.render( scene, camera );
			}
		</script>
	</body>
</html>